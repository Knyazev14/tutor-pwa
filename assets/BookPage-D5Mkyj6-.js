import{r as f,j as e,u as R,a as $,R as I,L as A,B as T}from"./index-DrmWgVJa.js";import{B as C}from"./book.api-D3dkb6cF.js";import{u as O}from"./useReferenceData-BYBphfdW.js";import{t as L,f as H,r as P}from"./ru-BWtC3rzl.js";import"./student.api-DOernjy9.js";import"./category.api-DOn8z2Qz.js";import"./status.api-BNgZCtml.js";const G=()=>{const[m,u]=f.useState([]),[x,s]=f.useState(!1),[p,a]=f.useState(null),t=f.useCallback(async()=>{s(!0),a(null);try{const i=await C.getAll();return u(i.data),i.data}catch(i){const n=i.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð±Ñ€Ð¾Ð½ÐµÐ¹";throw a(n),i}finally{s(!1)}},[]),r=f.useCallback(async i=>{s(!0),a(null);try{return(await C.getById(i)).data}catch(n){const c=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð±Ñ€Ð¾Ð½Ð¸";throw a(c),n}finally{s(!1)}},[]),g=f.useCallback(async i=>{s(!0),a(null);try{const n=await C.create(i);return await t(),n.data}catch(n){const c=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(c),n}finally{s(!1)}},[t]),l=f.useCallback(async(i,n)=>{s(!0),a(null);try{const c=await C.update(i,n);return await t(),c.data}catch(c){const h=c.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(h),c}finally{s(!1)}},[t]),o=f.useCallback(async i=>{s(!0),a(null);try{await C.delete(i),await t()}catch(n){const c=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(c),n}finally{s(!1)}},[t]);return{books:m,loading:x,error:p,fetchBooks:t,getBook:r,createBook:g,updateBook:l,deleteBook:o}},J=m=>{const[u,x]=f.useState("all"),s=f.useMemo(()=>{if(!m.length)return[];const a=new Date;a.setHours(0,0,0,0);let t=[...m];switch(u){case"active":t=t.filter(r=>{const g=new Date(r.startDate);if(r.endDate){const l=new Date(r.endDate);return g<=a&&l>=a}return g<=a});break;case"inactive":t=t.filter(r=>{const g=r.endDate?new Date(r.endDate):null;return g&&g<a});break;case"online":t=t.filter(r=>r.lessonFormat==="online");break;case"offline":t=t.filter(r=>r.lessonFormat==="offline");break}return t},[m,u]);return{filter:u,setFilter:x,filteredBooks:s,getFilterButtonClass:a=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${u===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`}};function q(m,u){return+L(m)>+L(u)}function K({booking:m,onEdit:u,onDelete:x}){const[s,p]=f.useState(!1),{id:a,timeFrom:t,timeTo:r,startDate:g,endDate:l,bookStatus:o,lessonFormat:i,student:n,lessonCategory:c,lessonsCount:h}=m,v=b=>{if(!b)return"Ð‘ÐµÑÑÑ€Ð¾Ñ‡Ð½Ð¾";try{const k=new Date(b);return H(k,"d MMM yyyy",{locale:P})}catch{return b}},y=(()=>{const b=new Date,k=new Date(g);if(q(b,k)){if(l){const B=new Date(l);return!q(b,B)}return!0}return!1})(),N=()=>y?o?"bg-green-50 border-green-300":"bg-yellow-50 border-yellow-300":"bg-gray-100 border-gray-300",S=()=>i==="online"?"ðŸ’»":"ðŸ«",D=()=>y?o?"âœ…":"â³":"ðŸ“¦",F=()=>y?o?"ÐÐºÑ‚Ð¸Ð²Ð½Ð°":"ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ":"ÐÑ€Ñ…Ð¸Ð²Ð½Ð°Ñ";return e.jsxs("div",{className:`
        relative border-2 rounded-xl p-5 transition-all duration-300
        ${N()}
        ${s?"shadow-lg scale-[1.02]":"shadow hover:shadow-md"}
      `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-white/50 px-2 py-1 rounded-full",children:["#",a]}),e.jsxs("span",{className:`
            text-xs px-3 py-1 rounded-full font-medium
            ${y?o?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-600"}
          `,children:[D()," ",F()]})]}),e.jsx("button",{onClick:()=>p(!s),className:"text-gray-500 hover:text-gray-700 transition-colors",children:s?"â–¼":"â–¶"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 text-blue-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsx("span",{className:"font-medium",children:n?.name||"Ð‘ÐµÐ· Ð¸Ð¼ÐµÐ½Ð¸"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 text-purple-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ“š"}),e.jsx("span",{children:c?.name||"Ð‘ÐµÐ· ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"â°"}),e.jsxs("span",{children:[t," â€” ",r]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:S()}),e.jsx("span",{className:"capitalize",children:i==="online"?"ÐžÐ½Ð»Ð°Ð¹Ð½":"ÐžÑ„Ð»Ð°Ð¹Ð½"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("span",{children:"ðŸ“…"}),e.jsxs("span",{children:["Ð¡ ",v(g)]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("span",{children:"âž¡ï¸"}),e.jsxs("span",{children:["ÐŸÐ¾ ",v(l)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“Š Ð—Ð°Ð½ÑÑ‚Ð¸Ð¹:"}),e.jsx("span",{className:"font-bold text-lg text-blue-600",children:h||0})]}),s&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200 flex gap-2 flex-wrap",children:[u&&e.jsx("button",{onClick:()=>u(m),className:"flex-1 py-2 px-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium",children:"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"}),x&&e.jsx("button",{onClick:()=>x(a),className:"flex-1 py-2 px-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]})]})}function Q({isOpen:m,onClose:u,onSubmit:x,booking:s,students:p,categories:a}){const[t,r]=f.useState({timeFrom:"",timeTo:"",startDate:"",endDate:"",bookStatus:!0,lessonFormat:"offline",studentId:"",lessonCategoryId:""});if(f.useEffect(()=>{r(s?{timeFrom:s.timeFrom||"",timeTo:s.timeTo||"",startDate:s.startDate||"",endDate:s.endDate||"",bookStatus:s.bookStatus??!0,lessonFormat:s.lessonFormat||"offline",studentId:s.student?.id||"",lessonCategoryId:s.lessonCategory?.id||""}:{timeFrom:"",timeTo:"",startDate:"",endDate:"",bookStatus:!0,lessonFormat:"offline",studentId:"",lessonCategoryId:""})},[s]),!m)return null;const g=o=>{o.preventDefault(),x(t)},l=o=>{const{name:i,value:n,type:c,checked:h}=o.target;r(v=>({...v,[i]:c==="checkbox"?h:n}))};return e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-start md:items-center justify-center z-50 p-4 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"bg-white rounded-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:s?"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ñ€Ð¾Ð½ÑŒ":"âž• ÐÐ¾Ð²Ð°Ñ Ð±Ñ€Ð¾Ð½ÑŒ"}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ‘¤ Ð£Ñ‡ÐµÐ½Ð¸Ðº *"}),e.jsxs("select",{name:"studentId",value:t.studentId,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑƒÑ‡ÐµÐ½Ð¸ÐºÐ°"}),p?.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“š ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ *"}),e.jsxs("select",{name:"lessonCategoryId",value:t.lessonCategoryId,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚"}),a?.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"â° Ð’Ñ€ÐµÐ¼Ñ Ñ *"}),e.jsx("input",{type:"time",name:"timeFrom",value:t.timeFrom,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"â° Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ *"}),e.jsx("input",{type:"time",name:"timeTo",value:t.timeTo,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ *"}),e.jsx("input",{type:"date",name:"startDate",value:t.startDate,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… ÐžÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ðµ"}),e.jsx("input",{type:"date",name:"endDate",value:t.endDate,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ« Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"lessonFormat",value:"offline",checked:t.lessonFormat==="offline",onChange:l,className:"mr-2"}),"ðŸ« ÐžÑ„Ð»Ð°Ð¹Ð½"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"lessonFormat",value:"online",checked:t.lessonFormat==="online",onChange:l,className:"mr-2"}),"ðŸ’» ÐžÐ½Ð»Ð°Ð¹Ð½"]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"bookStatus",checked:t.bookStatus,onChange:l,className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"ÐÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:s?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ":"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ"}),e.jsx("button",{type:"button",onClick:u,className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]})]})})})}function ee(){const m=R(),{isAuthenticated:u}=$(),{books:x,loading:s,error:p,fetchBooks:a,createBook:t,updateBook:r,deleteBook:g}=G(),{students:l,categories:o,loading:i}=O(),{setFilter:n,filteredBooks:c,getFilterButtonClass:h}=J(x),[v,w]=I.useState(!1),[y,N]=I.useState(null),[S,D]=I.useState(!1);f.useEffect(()=>{if(!u){m("/login");return}a()},[u,m,a]);const F=()=>{N(null),w(!0)},b=d=>{N(d),w(!0)},k=async d=>{if(window.confirm("Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð±Ñ€Ð¾Ð½ÑŒ?"))try{await g(d),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")}catch(j){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+j.message)}},B=async(d,j)=>{const E=x.find(M=>M.id===d);if(E)try{await r(d,{...E,bookStatus:j})}catch{alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°")}},z=async d=>{D(!0);try{const j={timeFrom:d.timeFrom,timeTo:d.timeTo,startDate:d.startDate,endDate:d.endDate||null,bookStatus:d.bookStatus,lessonFormat:d.lessonFormat,studentId:parseInt(d.studentId),lessonCategoryId:parseInt(d.lessonCategoryId)};y?(await r(y.id,j),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°")):(await t(j),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°")),w(!1),N(null)}catch(j){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+j.message)}finally{D(!1)}};return s&&!x.length||i?e.jsx(A,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["ðŸ“š Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",c.length," Ð¸Ð· ",x.length,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{onClick:F,variant:"success",icon:e.jsx("span",{children:"âž•"}),size:"sm",children:"ÐÐ¾Ð²Ð°Ñ Ð±Ñ€Ð¾Ð½ÑŒ"}),e.jsx(T,{onClick:a,disabled:s,variant:"primary",icon:e.jsx("span",{children:"ðŸ”„"}),size:"sm",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>n("all"),className:h("all"),children:"Ð’ÑÐµ"}),e.jsx("button",{onClick:()=>n("active"),className:h("active"),children:"âœ… ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ"}),e.jsx("button",{onClick:()=>n("inactive"),className:h("inactive"),children:"ðŸ“¦ ÐÑ€Ñ…Ð¸Ð²Ð½Ñ‹Ðµ"}),e.jsx("button",{onClick:()=>n("online"),className:h("online"),children:"ðŸ’» ÐžÐ½Ð»Ð°Ð¹Ð½"}),e.jsx("button",{onClick:()=>n("offline"),className:h("offline"),children:"ðŸ« ÐžÑ„Ð»Ð°Ð¹Ð½"})]}),p&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:["âŒ ",p]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(d=>e.jsx(K,{booking:d,onStatusChange:B,onEdit:b,onDelete:k},d.id))}):!s&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:x.length===0?"ðŸ“­ ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ð±Ñ€Ð¾Ð½ÑÑ…":"ðŸ” ÐÐµÑ‚ Ð±Ñ€Ð¾Ð½ÐµÐ¹ Ð¿Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¼Ñƒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñƒ"}),x.length===0&&e.jsx(T,{onClick:F,variant:"success",className:"mt-4",children:"âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð±Ñ€Ð¾Ð½ÑŒ"})]}),e.jsx(Q,{isOpen:v,onClose:()=>{w(!1),N(null)},onSubmit:z,booking:y,students:l,categories:o}),S&&e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx(A,{})})})]})}export{ee as default};
//# sourceMappingURL=BookPage-D5Mkyj6-.js.map
