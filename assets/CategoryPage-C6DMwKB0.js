import{r as c,j as e,u as A,a as D,R as S,L as I,B as L}from"./index-DxFZvIyj.js";import{C as b}from"./category.api-C-rYvzvn.js";const F=()=>{const[a,u]=c.useState([]),[m,s]=c.useState(!1),[i,r]=c.useState(null),x=c.useCallback(async()=>{s(!0),r(null);try{const t=await b.getAll();return u(t.data),t.data}catch(t){const l=t.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹";throw r(l),t}finally{s(!1)}},[]),g=c.useCallback(async t=>{s(!0),r(null);try{return(await b.getById(t)).data}catch(l){const o=l.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸";throw r(o),l}finally{s(!1)}},[]),h=c.useCallback(async t=>{s(!0),r(null);try{const l=await b.create(t);return await x(),l.data}catch(l){const o=l.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸";throw r(o),l}finally{s(!1)}},[x]),p=c.useCallback(async(t,l)=>{s(!0),r(null);try{const o=await b.update(t,l);return await x(),o.data}catch(o){const N=o.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸";throw r(N),o}finally{s(!1)}},[x]),n=c.useCallback(async t=>{s(!0),r(null);try{await b.delete(t),await x()}catch(l){const o=l.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸";throw r(o),l}finally{s(!1)}},[x]);return{categories:a,loading:m,error:i,fetchCategories:x,getCategory:g,createCategory:h,updateCategory:p,deleteCategory:n}},Q=a=>{const[u,m]=c.useState(""),[s,i]=c.useState("name"),[r,x]=c.useState("asc"),g=c.useMemo(()=>{if(!a.length)return[];let n=[...a];if(u){const t=u.toLowerCase();n=n.filter(l=>l.name?.toLowerCase().includes(t))}return n.sort((t,l)=>{let o=0;switch(s){case"name":o=(t.name||"").localeCompare(l.name||"");break;case"price":o=(t.price||0)-(l.price||0);break;case"books":o=(t.booksCount||0)-(l.booksCount||0);break;case"lessons":o=(t.lessonsCount||0)-(l.lessonsCount||0);break;default:o=0}return r==="asc"?o:-o}),n},[a,u,s,r]),h=c.useMemo(()=>({total:a.length,totalBooks:a.reduce((n,t)=>n+(t.booksCount||0),0),totalLessons:a.reduce((n,t)=>n+(t.lessonsCount||0),0),averagePrice:a.length?Math.round(a.reduce((n,t)=>n+(t.price||0),0)/a.length):0,maxPrice:Math.max(...a.map(n=>n.price||0),0),minPrice:Math.min(...a.map(n=>n.price||0),1/0)||0}),[a]);return{searchQuery:u,setSearchQuery:m,sortBy:s,setSortBy:i,sortOrder:r,toggleSortOrder:()=>{x(n=>n==="asc"?"desc":"asc")},filteredCategories:g,stats:h}};function U({category:a,onEdit:u,onDelete:m}){const[s,i]=c.useState(!1),r=x=>new Intl.NumberFormat("ru-RU").format(x||0);return e.jsxs("div",{className:"relative border-2 rounded-xl p-5 transition-all duration-300 bg-white border-gray-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs font-mono bg-gray-100 px-2 py-1 rounded-full",children:["#",a.id]})}),e.jsx("button",{onClick:()=>i(!s),className:"text-gray-500 hover:text-gray-700 transition-colors",children:s?"â–¼":"â–¶"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center text-2xl",children:"ðŸ“š"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:a.name||"Ð‘ÐµÐ· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",a.id]})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"Ð¦ÐµÐ½Ð° Ð·Ð°Ð½ÑÑ‚Ð¸Ñ"}),e.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[r(a.price)," Ñ€"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-blue-600 font-bold",children:a.booksCount||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Ð‘Ñ€Ð¾Ð½ÐµÐ¹"})]}),e.jsxs("div",{className:"bg-orange-50 p-2 rounded-lg text-center",children:[e.jsx("div",{className:"text-orange-600 font-bold",children:a.lessonsCount||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Ð£Ñ€Ð¾ÐºÐ¾Ð²"})]})]}),s&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200 flex gap-2",children:[u&&e.jsx("button",{onClick:()=>u(a),className:"flex-1 py-2 px-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium",children:"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"}),m&&e.jsx("button",{onClick:()=>m(a.id),className:"flex-1 py-2 px-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]}),a.booksCount>0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"ÐÐºÑ‚Ð¸Ð²Ð½Ð°"})})]})}function q({isOpen:a,onClose:u,onSubmit:m,category:s}){const[i,r]=c.useState({name:"",price:"",slug:""});if(c.useEffect(()=>{r(s?{name:s.name||"",price:s.price||"",slug:s.slug||""}:{name:"",price:"",slug:""})},[s]),!a)return null;const x=h=>{h.preventDefault();const p=i.slug||i.name.toLowerCase().replace(/[^Ð°-Ña-z0-9]+/g,"-").replace(/^-|-$/g,"");m({...i,price:parseInt(i.price)||0,slug:p})},g=h=>{const{name:p,value:n}=h.target;r(t=>({...t,[p]:n}))};return e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-start md:items-center justify-center z-50 p-4 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"bg-white rounded-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:s?"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ":"âž• ÐÐ¾Ð²Ð°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ"}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“š ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ *"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:g,required:!0,placeholder:"ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: ÐœÐ°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐ°",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ’° Ð¦ÐµÐ½Ð° Ð·Ð°Ð½ÑÑ‚Ð¸Ñ"}),e.jsx("input",{type:"number",name:"price",value:i.price,onChange:g,min:"0",placeholder:"1000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ”— Slug (URL)"}),e.jsx("input",{type:"text",name:"slug",value:i.slug,onChange:g,placeholder:"matematika",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ÐžÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:s?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ":"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ"}),e.jsx("button",{type:"button",onClick:u,className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]})]})})})}function H(){const a=A(),{isAuthenticated:u}=D(),{categories:m,loading:s,error:i,fetchCategories:r,createCategory:x,updateCategory:g,deleteCategory:h}=F(),{searchQuery:p,setSearchQuery:n,sortBy:t,setSortBy:l,sortOrder:o,toggleSortOrder:N,filteredCategories:C,stats:j}=Q(m),[O,y]=S.useState(!1),[w,v]=S.useState(null),[P,M]=S.useState(!1);c.useEffect(()=>{if(!u){a("/login");return}r()},[u,a,r]);const E=()=>{v(null),y(!0)},B=d=>{v(d),y(!0)},R=async d=>{if(window.confirm("Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ?"))try{await h(d),alert("âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")}catch(f){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+f.message)}},z=async d=>{M(!0);try{const f={name:d.name,price:parseInt(d.price)||0,slug:d.slug};w?(await g(w.id,f),alert("âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°")):(await x(f),alert("âœ… ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°")),y(!1),v(null)}catch(f){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+f.message)}finally{M(!1)}};if(s&&!m.length)return e.jsx(I,{fullScreen:!0});const k=d=>new Intl.NumberFormat("ru-RU").format(d||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["ðŸ“š ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑƒÑ€Ð¾ÐºÐ¾Ð²",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",C.length," Ð¸Ð· ",m.length,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{onClick:E,variant:"success",icon:e.jsx("span",{children:"âž•"}),size:"sm",children:"ÐÐ¾Ð²Ð°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ"}),e.jsx(L,{onClick:r,disabled:s,variant:"primary",icon:e.jsx("span",{children:"ðŸ”„"}),size:"sm",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600",children:"Ð’ÑÐµÐ³Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:j.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ñ†ÐµÐ½Ð°"}),e.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[k(j.averagePrice)," Ñ€"]})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-orange-600",children:"ÐœÐ¸Ð½. Ñ†ÐµÐ½Ð°"}),e.jsxs("div",{className:"text-2xl font-bold text-orange-700",children:[k(j.minPrice)," Ñ€"]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-purple-600",children:"ÐœÐ°ÐºÑ. Ñ†ÐµÐ½Ð°"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[k(j.maxPrice)," Ñ€"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ...",value:p,onChange:d=>n(d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t,onChange:d=>l(d.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",children:[e.jsx("option",{value:"name",children:"ÐŸÐ¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ"}),e.jsx("option",{value:"price",children:"ÐŸÐ¾ Ñ†ÐµÐ½Ðµ"}),e.jsx("option",{value:"books",children:"ÐŸÐ¾ Ð±Ñ€Ð¾Ð½ÑÐ¼"}),e.jsx("option",{value:"lessons",children:"ÐŸÐ¾ ÑƒÑ€Ð¾ÐºÐ°Ð¼"})]}),e.jsx("button",{onClick:N,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:o==="asc"?"ÐŸÐ¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð°Ð½Ð¸ÑŽ":"ÐŸÐ¾ ÑƒÐ±Ñ‹Ð²Ð°Ð½Ð¸ÑŽ",children:o==="asc"?"â†‘":"â†“"})]})]}),i&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:["âŒ ",i]}),C.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(d=>e.jsx(U,{category:d,onEdit:B,onDelete:R},d.id))}):!s&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:m.length===0?"ðŸ“­ ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÑ…":"ðŸ” ÐÐµÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ"}),m.length===0&&e.jsx(L,{onClick:E,variant:"success",className:"mt-4",children:"âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²ÑƒÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ"})]}),e.jsx(q,{isOpen:O,onClose:()=>{y(!1),v(null)},onSubmit:z,category:w}),P&&e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx(I,{})})})]})}export{H as default};
//# sourceMappingURL=CategoryPage-C6DMwKB0.js.map
