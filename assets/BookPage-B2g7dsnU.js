import{i as C,a as f,j as e,u as R,b as O,R as T,L as $,B as E}from"./index-Dh8SOJfd.js";import{u as H}from"./useReferenceData-DaD4Omaa.js";import{t as L,f as P,r as G}from"./ru-BWtC3rzl.js";import"./student.api-BrWHZZhZ.js";import"./category.api-tDpLbD71.js";import"./status.api-DP_Hl0gk.js";const D={getAll(){return C.get("api/v1/book/get")},getById(r){return C.get(`api/v1/book/get/${r}`)},create(r){return C.post("api/v1/book/create",r)},update(r,d){return C.put(`api/v1/book/update/${r}`,d)},delete(r){return C.delete(`api/v1/book/delete/${r}`)}},J=()=>{const[r,d]=f.useState([]),[x,t]=f.useState(!1),[p,a]=f.useState(null),s=f.useCallback(async()=>{t(!0),a(null);try{const c=await D.getAll();return d(c.data),c.data}catch(c){const n=c.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð±Ñ€Ð¾Ð½ÐµÐ¹";throw a(n),c}finally{t(!1)}},[]),l=f.useCallback(async c=>{t(!0),a(null);try{return(await D.getById(c)).data}catch(n){const u=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð±Ñ€Ð¾Ð½Ð¸";throw a(u),n}finally{t(!1)}},[]),g=f.useCallback(async c=>{t(!0),a(null);try{const n=await D.create(c);return await s(),n.data}catch(n){const u=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(u),n}finally{t(!1)}},[s]),o=f.useCallback(async(c,n)=>{t(!0),a(null);try{const u=await D.update(c,n);return await s(),u.data}catch(u){const h=u.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(h),u}finally{t(!1)}},[s]),i=f.useCallback(async c=>{t(!0),a(null);try{await D.delete(c),await s()}catch(n){const u=n.response?.data?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð±Ñ€Ð¾Ð½Ð¸";throw a(u),n}finally{t(!1)}},[s]);return{books:r,loading:x,error:p,fetchBooks:s,getBook:l,createBook:g,updateBook:o,deleteBook:i}},K=r=>{const[d,x]=f.useState("all"),t=f.useMemo(()=>{if(!r.length)return[];const a=new Date;a.setHours(0,0,0,0);let s=[...r];switch(d){case"active":s=s.filter(l=>{const g=new Date(l.startDate);if(l.endDate){const o=new Date(l.endDate);return g<=a&&o>=a}return g<=a});break;case"inactive":s=s.filter(l=>{const g=l.endDate?new Date(l.endDate):null;return g&&g<a});break;case"online":s=s.filter(l=>l.lessonFormat==="online");break;case"offline":s=s.filter(l=>l.lessonFormat==="offline");break}return s},[r,d]);return{filter:d,setFilter:x,filteredBooks:t,getFilterButtonClass:a=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d===a?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`}};function q(r,d){return+L(r)>+L(d)}function Q({booking:r,onEdit:d,onDelete:x}){const[t,p]=f.useState(!1),{id:a,timeFrom:s,timeTo:l,startDate:g,endDate:o,bookStatus:i,lessonFormat:c,student:n,lessonCategory:u,lessonsCount:h}=r,v=y=>{if(!y)return"Ð‘ÐµÑÑÑ€Ð¾Ñ‡Ð½Ð¾";try{const w=new Date(y);return P(w,"d MMM yyyy",{locale:G})}catch{return y}},b=(()=>{const y=new Date,w=new Date(g);if(q(y,w)){if(o){const I=new Date(o);return!q(y,I)}return!0}return!1})(),N=()=>b?i?"bg-green-50 border-green-300":"bg-yellow-50 border-yellow-300":"bg-gray-100 border-gray-300",B=()=>c==="online"?"ðŸ’»":"ðŸ«",F=()=>b?i?"âœ…":"â³":"ðŸ“¦",S=()=>b?i?"ÐÐºÑ‚Ð¸Ð²Ð½Ð°":"ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ":"ÐÑ€Ñ…Ð¸Ð²Ð½Ð°Ñ";return e.jsxs("div",{className:`
        relative border-2 rounded-xl p-5 transition-all duration-300
        ${N()}
        ${t?"shadow-lg scale-[1.02]":"shadow hover:shadow-md"}
      `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-white/50 px-2 py-1 rounded-full",children:["#",a]}),e.jsxs("span",{className:`
            text-xs px-3 py-1 rounded-full font-medium
            ${b?i?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-600"}
          `,children:[F()," ",S()]})]}),e.jsx("button",{onClick:()=>p(!t),className:"text-gray-500 hover:text-gray-700 transition-colors",children:t?"â–¼":"â–¶"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 text-blue-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsx("span",{className:"font-medium",children:n?.name||"Ð‘ÐµÐ· Ð¸Ð¼ÐµÐ½Ð¸"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 text-purple-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ“š"}),e.jsx("span",{children:u?.name||"Ð‘ÐµÐ· ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"â°"}),e.jsxs("span",{children:[s," â€” ",l]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:B()}),e.jsx("span",{className:"capitalize",children:c==="online"?"ÐžÐ½Ð»Ð°Ð¹Ð½":"ÐžÑ„Ð»Ð°Ð¹Ð½"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("span",{children:"ðŸ“…"}),e.jsxs("span",{children:["Ð¡ ",v(g)]})]}),o&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx("span",{children:"âž¡ï¸"}),e.jsxs("span",{children:["ÐŸÐ¾ ",v(o)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ðŸ“Š Ð—Ð°Ð½ÑÑ‚Ð¸Ð¹:"}),e.jsx("span",{className:"font-bold text-lg text-blue-600",children:h||0})]}),t&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200 flex gap-2 flex-wrap",children:[d&&e.jsx("button",{onClick:()=>d(r),className:"flex-1 py-2 px-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium",children:"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"}),x&&e.jsx("button",{onClick:()=>x(a),className:"flex-1 py-2 px-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]})]})}function U({isOpen:r,onClose:d,onSubmit:x,booking:t,students:p,categories:a}){const[s,l]=f.useState({timeFrom:"",timeTo:"",startDate:"",endDate:"",bookStatus:!0,lessonFormat:"offline",studentId:"",lessonCategoryId:""});if(f.useEffect(()=>{l(t?{timeFrom:t.timeFrom||"",timeTo:t.timeTo||"",startDate:t.startDate||"",endDate:t.endDate||"",bookStatus:t.bookStatus??!0,lessonFormat:t.lessonFormat||"offline",studentId:t.student?.id||"",lessonCategoryId:t.lessonCategory?.id||""}:{timeFrom:"",timeTo:"",startDate:"",endDate:"",bookStatus:!0,lessonFormat:"offline",studentId:"",lessonCategoryId:""})},[t]),!r)return null;const g=i=>{i.preventDefault(),x(s)},o=i=>{const{name:c,value:n,type:u,checked:h}=i.target;l(v=>({...v,[c]:u==="checkbox"?h:n}))};return e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-start md:items-center justify-center z-50 p-4 overflow-y-auto overflow-x-hidden",children:e.jsx("div",{className:"bg-white rounded-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:t?"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ñ€Ð¾Ð½ÑŒ":"âž• ÐÐ¾Ð²Ð°Ñ Ð±Ñ€Ð¾Ð½ÑŒ"}),e.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ‘¤ Ð£Ñ‡ÐµÐ½Ð¸Ðº *"}),e.jsxs("select",{name:"studentId",value:s.studentId,onChange:o,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑƒÑ‡ÐµÐ½Ð¸ÐºÐ°"}),p?.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“š ÐŸÑ€ÐµÐ´Ð¼ÐµÑ‚ *"}),e.jsxs("select",{name:"lessonCategoryId",value:s.lessonCategoryId,onChange:o,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚"}),a?.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"â° Ð’Ñ€ÐµÐ¼Ñ Ñ *"}),e.jsx("input",{type:"time",name:"timeFrom",value:s.timeFrom,onChange:o,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"â° Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ *"}),e.jsx("input",{type:"time",name:"timeTo",value:s.timeTo,onChange:o,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… ÐÐ°Ñ‡Ð°Ð»Ð¾ *"}),e.jsx("input",{type:"date",name:"startDate",value:s.startDate,onChange:o,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ“… ÐžÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ðµ"}),e.jsx("input",{type:"date",name:"endDate",value:s.endDate,onChange:o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ðŸ« Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"lessonFormat",value:"offline",checked:s.lessonFormat==="offline",onChange:o,className:"mr-2"}),"ðŸ« ÐžÑ„Ð»Ð°Ð¹Ð½"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"lessonFormat",value:"online",checked:s.lessonFormat==="online",onChange:o,className:"mr-2"}),"ðŸ’» ÐžÐ½Ð»Ð°Ð¹Ð½"]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"bookStatus",checked:s.bookStatus,onChange:o,className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"ÐÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:t?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ":"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ"}),e.jsx("button",{type:"button",onClick:d,className:"flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]})]})})})}function ee(){const r=R(),{isAuthenticated:d}=O(),{books:x,loading:t,error:p,fetchBooks:a,createBook:s,updateBook:l,deleteBook:g}=J(),{students:o,categories:i,loading:c}=H(),{setFilter:n,filteredBooks:u,getFilterButtonClass:h}=K(x),[v,k]=T.useState(!1),[b,N]=T.useState(null),[B,F]=T.useState(!1);f.useEffect(()=>{if(!d){r("/login");return}a()},[d,r,a]);const S=()=>{N(null),k(!0)},y=m=>{N(m),k(!0)},w=async m=>{if(window.confirm("Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð±Ñ€Ð¾Ð½ÑŒ?"))try{await g(m),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°")}catch(j){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+j.message)}},I=async(m,j)=>{const M=x.find(A=>A.id===m);if(M)try{await l(m,{...M,bookStatus:j})}catch{alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°")}},z=async m=>{F(!0);try{const j={timeFrom:m.timeFrom,timeTo:m.timeTo,startDate:m.startDate,endDate:m.endDate||null,bookStatus:m.bookStatus,lessonFormat:m.lessonFormat,studentId:parseInt(m.studentId),lessonCategoryId:parseInt(m.lessonCategoryId)};b?(await l(b.id,j),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°")):(await s(j),alert("âœ… Ð‘Ñ€Ð¾Ð½ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°")),k(!1),N(null)}catch(j){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+j.message)}finally{F(!1)}};return t&&!x.length||c?e.jsx($,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["ðŸ“š Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",u.length," Ð¸Ð· ",x.length,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{onClick:S,variant:"success",icon:e.jsx("span",{children:"âž•"}),size:"sm",children:"ÐÐ¾Ð²Ð°Ñ Ð±Ñ€Ð¾Ð½ÑŒ"}),e.jsx(E,{onClick:a,disabled:t,variant:"primary",icon:e.jsx("span",{children:"ðŸ”„"}),size:"sm",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>n("all"),className:h("all"),children:"Ð’ÑÐµ"}),e.jsx("button",{onClick:()=>n("active"),className:h("active"),children:"âœ… ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ"}),e.jsx("button",{onClick:()=>n("inactive"),className:h("inactive"),children:"ðŸ“¦ ÐÑ€Ñ…Ð¸Ð²Ð½Ñ‹Ðµ"}),e.jsx("button",{onClick:()=>n("online"),className:h("online"),children:"ðŸ’» ÐžÐ½Ð»Ð°Ð¹Ð½"}),e.jsx("button",{onClick:()=>n("offline"),className:h("offline"),children:"ðŸ« ÐžÑ„Ð»Ð°Ð¹Ð½"})]}),p&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:["âŒ ",p]}),u.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(m=>e.jsx(Q,{booking:m,onStatusChange:I,onEdit:y,onDelete:w},m.id))}):!t&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:x.length===0?"ðŸ“­ ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾ Ð±Ñ€Ð¾Ð½ÑÑ…":"ðŸ” ÐÐµÑ‚ Ð±Ñ€Ð¾Ð½ÐµÐ¹ Ð¿Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¼Ñƒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñƒ"}),x.length===0&&e.jsx(E,{onClick:S,variant:"success",className:"mt-4",children:"âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð±Ñ€Ð¾Ð½ÑŒ"})]}),e.jsx(U,{isOpen:v,onClose:()=>{k(!1),N(null)},onSubmit:z,booking:b,students:o,categories:i}),B&&e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx($,{})})})]})}export{ee as default};
//# sourceMappingURL=BookPage-B2g7dsnU.js.map
