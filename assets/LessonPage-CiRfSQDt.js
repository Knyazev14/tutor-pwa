import{r as f,j as e,u as R,a as $,R as D,L as M,B as I}from"./index-CxWwzzE3.js";import{u as z,L as A}from"./LessonModal-DD0-e0fq.js";import{u as O}from"./useReferenceData-BO3pf6EK.js";import{f as q,r as G}from"./ru-BWtC3rzl.js";import"./lesson.api-DX3aFgMz.js";import"./student.api-Dd7ZWYGw.js";import"./category.api-Cjmrlk1P.js";import"./status.api-BLfehEg-.js";const H=t=>{const[n,c]=f.useState("all"),[d,u]=f.useState(""),i=s=>s.status?.slug||s.status?.name?.toLowerCase()||"",b=f.useMemo(()=>{if(!t.length)return[];let s=[...t];return n!=="all"&&(s=s.filter(r=>i(r)===n)),d&&(s=s.filter(r=>r.startDate?r.startDate.split(" ")[0]===d:!1)),s.sort((r,g)=>{const o=r.startDate?new Date(r.startDate):new Date(0);return(g.startDate?new Date(g.startDate):new Date(0))-o}),s},[t,n,d]),j=s=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,y=f.useMemo(()=>({total:t.length,pending:t.filter(s=>i(s)==="pending").length,paid:t.filter(s=>i(s)==="paid").length,completed:t.filter(s=>i(s)==="completed").length,cancelled:t.filter(s=>i(s)==="cancelled").length,totalIncome:t.reduce((s,r)=>s+(r.price||0),0),totalPaid:t.reduce((s,r)=>s+(r.pricePaid||0),0)}),[t]);return{filter:n,setFilter:c,dateFilter:d,setDateFilter:u,filteredLessons:b,getFilterButtonClass:j,stats:y}};function J({lesson:t,onEdit:n,onDelete:c,onStatusChange:d}){const[u,i]=f.useState(!1),b=()=>{if(!t.startDate)return{date:"",time:""};const[a,x]=t.startDate.split(" ");return{date:a||"",time:x?x.substring(0,5):""}},j=()=>{if(!t.endDate)return"";const[,a]=t.endDate.split(" ");return a?a.substring(0,5):""},{date:y,time:s}=b(),r=j(),g=a=>{if(!a)return"Ð”Ð°Ñ‚Ð° Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½Ð°";try{const x=new Date(a);return q(x,"d MMMM yyyy",{locale:G})}catch{return a}},o=()=>t.status?.slug||t.status?.name?.toLowerCase()||"",m=()=>t.status?.name||"Ð‘ÐµÐ· ÑÑ‚Ð°Ñ‚ÑƒÑÐ°",v=()=>{const a=o();return{pending:"bg-yellow-50 border-yellow-300",paid:"bg-green-50 border-green-300",cancelled:"bg-red-50 border-red-300",completed:"bg-blue-50 border-blue-300"}[a]||"bg-gray-50 border-gray-300"},w=()=>{const a=o();return{pending:"bg-yellow-200 text-yellow-800",paid:"bg-green-200 text-green-800",cancelled:"bg-red-200 text-red-800",completed:"bg-blue-200 text-blue-800"}[a]||"bg-gray-200 text-gray-600"},N=()=>{const a=o();return{pending:"â³",paid:"âœ…",cancelled:"âŒ",completed:"âœ”ï¸"}[a]||"ðŸ“Š"},p=()=>{const a=o();return{pending:"ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ",paid:"ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾",cancelled:"ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾",completed:"ÐŸÑ€Ð¾Ð²ÐµÐ´ÐµÐ½Ð¾"}[a]||m()};return e.jsxs("div",{className:`
        relative border-2 rounded-xl p-5 transition-all duration-300
        ${v()}
        ${u?"shadow-lg scale-[1.02]":"shadow hover:shadow-md"}
      `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-white/50 px-2 py-1 rounded-full",children:["#",t.id]}),e.jsxs("span",{className:`
            text-xs px-3 py-1 rounded-full font-medium
            ${w()}
          `,children:[N()," ",p()]})]}),e.jsx("button",{onClick:()=>i(!u),className:"text-gray-500 hover:text-gray-700 transition-colors",children:u?"â–¼":"â–¶"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 text-blue-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ‘¤"}),e.jsx("span",{className:"font-medium",children:t.student?.name||"Ð‘ÐµÐ· Ð¸Ð¼ÐµÐ½Ð¸"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-purple-100 text-purple-800 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ“š"}),e.jsx("span",{children:t.category?.name||"Ð‘ÐµÐ· Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð°"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"ðŸ“…"}),e.jsx("span",{children:g(y)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("span",{children:"â°"}),e.jsxs("span",{children:[s||"--:--"," â€” ",r||"--:--"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("span",{children:"ðŸ’°"}),e.jsxs("span",{children:["Ð¦ÐµÐ½Ð°: ",e.jsxs("span",{className:"font-bold text-blue-600",children:[t.price||0,"Ñ€"]}),o()==="paid"&&e.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full",children:"âœ“ ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾"})]})]}),t.comment&&e.jsxs("div",{className:"text-sm text-gray-500 italic border-t pt-2 mt-2",children:["ðŸ“ ",t.comment]}),u&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200 flex gap-2 flex-wrap",children:[d&&e.jsx("button",{onClick:()=>d(t.id,t.status),className:"flex-1 py-2 px-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:"ðŸ”„ Ð¡Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ"}),n&&e.jsx("button",{onClick:()=>n(t),className:"flex-1 py-2 px-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium",children:"âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"}),c&&e.jsx("button",{onClick:()=>c(t.id),className:"flex-1 py-2 px-3 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"})]})]}),o()!=="paid"&&t.price>0&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-200 rounded-b-xl overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400",style:{width:"0%"}})})]})}function _(){const t=R(),{isAuthenticated:n}=$(),{lessons:c,loading:d,error:u,fetchLessons:i,createLesson:b,updateLesson:j,deleteLesson:y}=z(),{students:s,categories:r,statuses:g,loading:o}=O(),{setFilter:m,dateFilter:v,setDateFilter:w,filteredLessons:N,getFilterButtonClass:p,stats:a}=H(c),[x,S]=D.useState(!1),[L,C]=D.useState(null),[E,k]=D.useState(!1);f.useEffect(()=>{if(!n){t("/login");return}i()},[n,t,i]);const F=()=>{C(null),S(!0)},B=l=>{C(l),S(!0)},P=async l=>{if(window.confirm("Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ ÑƒÑ€Ð¾Ðº?"))try{await y(l),alert("âœ… Ð£Ñ€Ð¾Ðº ÑƒÐ´Ð°Ð»ÐµÐ½")}catch(h){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+h.message)}},T=async l=>{k(!0);try{const h={date:l.date,timeFrom:l.timeFrom,timeTo:l.timeTo,price:l.price?parseInt(l.price):0,comment:l.comment||null,studentId:parseInt(l.studentId),categoryId:parseInt(l.categoryId),statusId:parseInt(l.statusId)};L?(await j(L.id,h),alert("âœ… Ð£Ñ€Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½")):(await b(h),alert("âœ… Ð£Ñ€Ð¾Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½")),S(!1),C(null)}catch(h){alert("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: "+h.message)}finally{k(!1)}};return d&&!c.length||o?e.jsx(M,{fullScreen:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:["ðŸ“š Ð£Ñ€Ð¾ÐºÐ¸",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",N.length," Ð¸Ð· ",c.length,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:F,variant:"success",icon:e.jsx("span",{children:"âž•"}),size:"sm",children:"ÐÐ¾Ð²Ñ‹Ð¹ ÑƒÑ€Ð¾Ðº"}),e.jsx(I,{onClick:i,disabled:d,variant:"primary",icon:e.jsx("span",{children:"ðŸ”„"}),size:"sm",children:"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600",children:"Ð’ÑÐµÐ³Ð¾ ÑƒÑ€Ð¾ÐºÐ¾Ð²"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:a.total})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-yellow-600",children:"ÐžÐ¶Ð¸Ð´Ð°ÑŽÑ‚"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:a.pending})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:a.paid})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-red-600",children:"ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:a.cancelled})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m("all"),className:p("all"),children:"Ð’ÑÐµ"}),e.jsx("button",{onClick:()=>m("pending"),className:p("pending"),children:"â³ ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ"}),e.jsx("button",{onClick:()=>m("paid"),className:p("paid"),children:"âœ… ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾"}),e.jsx("button",{onClick:()=>m("cancelled"),className:p("cancelled"),children:"âŒ ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"ðŸ“… Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ:"}),e.jsx("input",{type:"date",value:v,onChange:l=>w(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),v&&e.jsx("button",{onClick:()=>w(""),className:"text-sm text-red-600 hover:text-red-700",children:"Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ"})]})]}),u&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:["âŒ ",u]}),N.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(l=>e.jsx(J,{lesson:l,onEdit:B,onDelete:P},l.id))}):!d&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:c.length===0?"ðŸ“­ ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¾Ð± ÑƒÑ€Ð¾ÐºÐ°Ñ…":"ðŸ” ÐÐµÑ‚ ÑƒÑ€Ð¾ÐºÐ¾Ð² Ð¿Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¼Ñƒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñƒ"}),c.length===0&&e.jsx(I,{onClick:F,variant:"success",className:"mt-4",children:"âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ ÑƒÑ€Ð¾Ðº"})]}),e.jsx(A,{isOpen:x,onClose:()=>{S(!1),C(null)},onSubmit:T,lesson:L,students:s,categories:r,statuses:g}),E&&e.jsx("div",{className:"fixed inset-0 bg-sky-100/70 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx(M,{})})})]})}export{_ as default};
//# sourceMappingURL=LessonPage-CiRfSQDt.js.map
